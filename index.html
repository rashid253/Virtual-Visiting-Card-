<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Local Image Background Removal</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .canvas-container {
      border: 3px solid #ff007f;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    canvas {
      max-width: 100%;
      display: block;
    }
    .btn {
      padding: 10px 20px;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      margin: 5px;
      cursor: pointer;
    }
    .btn:hover {
      background: #0056b3;
    }
    input[type="file"] {
      display: none;
    }
  </style>
</head>
<body>

<div class="canvas-container">
  <canvas id="canvas"></canvas>
</div>
<button id="uploadBtn" class="btn">Upload Image</button>
<button id="removeBg" class="btn">Remove Background</button>
<input type="file" id="fileInput" accept="image/*">

<script>
  const fileInput = document.getElementById('fileInput');
  const uploadBtn = document.getElementById('uploadBtn');
  const removeBgBtn = document.getElementById('removeBg');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  // Trigger file input when "Upload Image" button is clicked
  uploadBtn.addEventListener('click', () => {
    fileInput.click();
  });

  // Load the image from local file and draw it on the canvas
  fileInput.addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        // No crossOrigin needed for local blobs.
        img.onload = function() {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
        }
        img.src = e.target.result;
      }
      reader.readAsDataURL(file);
    }
  });

  // Remove background by making near-white pixels transparent
  removeBgBtn.addEventListener('click', function() {
    // Ensure the canvas has an image
    if (canvas.width === 0 || canvas.height === 0) {
      alert("Please upload an image first.");
      return;
    }
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = imageData.data;
    // Set threshold value (lower if your image background is not pure white)
    const threshold = 240;
    for (let i = 0; i < data.length; i += 4) {
      if (data[i] >= threshold && data[i + 1] >= threshold && data[i + 2] >= threshold) {
        data[i + 3] = 0; // Make pixel transparent
      }
    }
    ctx.putImageData(imageData, 0, 0);
  });
</script>

</body>
</html>
