<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Upload & Background Removal</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .container {
      border: 3px solid #ff007f;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .container img {
      width: 300px;
      height: 220px;
      object-fit: cover;
    }
    .btn {
      padding: 10px 20px;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      margin: 5px;
      cursor: pointer;
    }
    .btn:hover {
      background: #0056b3;
    }
    input[type="file"] {
      display: none;
    }
  </style>
</head>
<body>

<div class="container">
  <img id="templateImage" src="https://via.placeholder.com/300x220.png?text=Upload+an+Image" alt="Template Image">
</div>
<button id="uploadBtn" class="btn">Upload Image</button>
<button id="removeBg" class="btn">Remove Background</button>
<input type="file" id="imageInput" accept="image/*">

<script>
  const uploadBtn = document.getElementById('uploadBtn');
  const imageInput = document.getElementById('imageInput');
  const templateImage = document.getElementById('templateImage');
  const removeBgButton = document.getElementById('removeBg');

  // When "Upload Image" is clicked, trigger file input
  uploadBtn.addEventListener('click', function() {
    imageInput.click();
  });

  // When a file is selected, display it
  imageInput.addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        templateImage.src = e.target.result;
      }
      reader.readAsDataURL(file);
    }
  });

  // Remove background by making near-white pixels transparent
  removeBgButton.addEventListener('click', function() {
    const imgSrc = templateImage.src;
    const img = new Image();
    // Enable cross-origin processing if possible
    img.crossOrigin = "Anonymous";
    img.src = imgSrc;
    img.onload = function() {
      const canvas = document.createElement('canvas');
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);
      const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imgData.data;
      // Set threshold for near-white pixels; adjust if needed
      const threshold = 240;
      for (let i = 0; i < data.length; i += 4) {
        if (data[i] >= threshold && data[i+1] >= threshold && data[i+2] >= threshold) {
          data[i+3] = 0; // Make pixel transparent
        }
      }
      ctx.putImageData(imgData, 0, 0);
      templateImage.src = canvas.toDataURL();
    }
    img.onerror = function() {
      alert("Error processing image. Make sure the image allows cross-origin usage.");
    }
  });
</script>

</body>
</html>
