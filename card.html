<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Business Card</title>
  <!-- Font Awesome CDN -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    rel="stylesheet"
  />
  <style>
    /* (Keep all original CSS styles unchanged) */
    /* ... (All previous CSS content remains exactly the same) ... */
  </style>
</head>
<body>
  <!-- (Keep all HTML structure unchanged) -->
  <!-- ... (All previous HTML content remains exactly the same) ... -->

  <!-- Example HTML elements with IDs used in the script -->
  <img id="cardProfileImage" alt="Profile Image" />
  <h1 id="cardName"></h1>
  <h2 id="cardBusinessName"></h2>
  <p id="cardAddress"></p>
  <p id="cardPhone"></p>
  <p id="cardEmail"></p>
  <div id="businessInfoContent"></div>

  <!-- Social Media Icons -->
  <a id="facebookButton" class="social-icon" target="_blank">
    <i class="fab fa-facebook"></i>
  </a>
  <a id="instagramButton" class="social-icon" target="_blank">
    <i class="fab fa-instagram"></i>
  </a>
  <a id="youtubeButton" class="social-icon" target="_blank">
    <i class="fab fa-youtube"></i>
  </a>

  <!-- Mini Icons -->
  <button id="miniCallButton">Call</button>
  <button id="miniEmailButton">Email</button>
  <button id="miniWhatsappButton">WhatsApp</button>
  <button id="miniMapButton">Map</button>

  <!-- Connect Button -->
  <button id="connectButton">Connect</button>

  <!-- Action Buttons -->
  <button id="callButton">Call</button>
  <button id="whatsappButton">WhatsApp</button>
  <button id="emailButton">Email</button>

  <script>
    // Variables to hold selected options
    let selectedTheme = "default";
    let selectedAnim = "none";

    // Get URL parameters and set card details
    const params = new URLSearchParams(window.location.search);

    // Safe parameter handling with fallbacks
    const getParam = (name) => params.get(name) || '';

    // Set profile information
    document.getElementById('cardProfileImage').src = getParam('profileImage') || 'https://via.placeholder.com/90';
    document.getElementById('cardName').textContent = getParam('name');
    document.getElementById('cardBusinessName').textContent = getParam('businessName');
    document.getElementById('cardAddress').textContent = getParam('address');
    document.getElementById('cardPhone').textContent = getParam('phone');
    document.getElementById('cardEmail').textContent = getParam('email');

    // Business Info Section Fix
    const businessInfoContainer = document.getElementById('businessInfoContent');
    const businessInfo = getParam('businessInfo');
    if (businessInfo) {
      const paragraphs = businessInfo.split('\n').filter(p => p.trim() !== '');
      if (paragraphs.length > 0) {
        businessInfoContainer.innerHTML = paragraphs.map(p => `
          <div class="business-info-content">
            <p>${p}</p>
          </div>
        `).join('');
        
        let currentIndex = 0;
        const infoDivs = businessInfoContainer.querySelectorAll('.business-info-content');
        infoDivs.forEach((div, index) => div.style.display = index === 0 ? 'block' : 'none');
        
        setInterval(() => {
          infoDivs[currentIndex].style.display = 'none';
          currentIndex = (currentIndex + 1) % infoDivs.length;
          infoDivs[currentIndex].style.display = 'block';
        }, 8000);
      } else {
        businessInfoContainer.innerHTML = `
          <div class="business-info-content">
            <p>No business information available</p>
          </div>
        `;
      }
    }

    // Social Links Fix
    const socialConfig = {
      facebook: { id: 'facebookButton', param: 'facebook' },
      instagram: { id: 'instagramButton', param: 'instagram' },
      youtube: { id: 'youtubeButton', param: 'youtube' }
    };

    Object.values(socialConfig).forEach(({ id, param }) => {
      const url = getParam(param);
      const element = document.getElementById(id);
      if (element) {
        if (url) {
          element.href = url;
          // Use display property so that the button retains its shape
          element.style.display = 'inline-block';
        } else {
          element.style.display = 'none';
        }
      }
    });

    // Mini Icons Functionality
    const miniCallButton = document.getElementById('miniCallButton');
    const miniEmailButton = document.getElementById('miniEmailButton');
    const miniWhatsappButton = document.getElementById('miniWhatsappButton');
    const miniMapButton = document.getElementById('miniMapButton');

    if (miniCallButton)
      miniCallButton.onclick = () => window.location.href = `tel:${getParam('phone')}`;
    if (miniEmailButton)
      miniEmailButton.onclick = () => window.location.href = `mailto:${getParam('email')}`;
    if (miniWhatsappButton)
      miniWhatsappButton.onclick = () => window.location.href = `https://wa.me/${getParam('phone')}`;
    if (miniMapButton)
      miniMapButton.onclick = () => {
        window.open(`https://www.google.com/maps?q=${encodeURIComponent(getParam('address'))}`, '_blank');
      };

    // Connect Button Fix
    const connectButton = document.getElementById('connectButton');
    if (connectButton)
      connectButton.onclick = () => {
        const vCardContent = [
          'BEGIN:VCARD',
          'VERSION:3.0',
          `N:;${getParam('name')};;;`,
          `FN:${getParam('name')}`,
          `TEL;TYPE=CELL:${getParam('phone')}`,
          `EMAIL;TYPE=INTERNET:${getParam('email')}`,
          `ADR;TYPE=WORK:;;${getParam('address')};;;;`,
          'END:VCARD'
        ].join('\r\n');

        const blob = new Blob([vCardContent], { type: 'text/vcard' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `${getParam('name')}.vcf`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

    // Action Buttons Fix
    const callButton = document.getElementById('callButton');
    const whatsappButton = document.getElementById('whatsappButton');
    const emailButton = document.getElementById('emailButton');

    if (callButton)
      callButton.onclick = () => window.location.href = `tel:${getParam('phone')}`;
    if (whatsappButton)
      whatsappButton.onclick = () => window.location.href = `https://wa.me/${getParam('phone')}`;
    if (emailButton)
      emailButton.onclick = () => window.location.href = `mailto:${getParam('email')}`;

    // (Keep rest of the JavaScript code unchanged)
    // ... (All remaining original JavaScript code for style controls, etc) ...
  </script>
</body>
</html>
